<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¶„ë¥˜ í†µê³„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        #charts { display: flex; gap: 30px; flex-wrap: wrap; }
        canvas { width: 400px !important; height: 300px !important; }
    </style>
</head>
<body>
<h2>ğŸ“Š ì´ë¯¸ì§€ ë¶„ë¥˜ í†µê³„</h2>

<div id="charts">
    <canvas id="dailyChart"></canvas>
    <canvas id="weeklyChart"></canvas>
    <canvas id="monthlyChart"></canvas>
</div>
<div><a href = "/list">ìƒì„¸ ëª©ë¡</a></div>

<script>
function renderChart(canvasId, labels, data, title) {
    new Chart($("#" + canvasId), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                { label: 'ì •ìƒ', data: data.good, backgroundColor: 'green' },
                { label: 'ë¶ˆëŸ‰', data: data.bad, backgroundColor: 'red' },
                { label: 'ë¶ˆëŸ‰ë¥ (%)', data: data.rate, type: 'line', borderColor: 'blue', yAxisID: 'y1' }
            ]
        },
        options: {
            responsive: true,
            plugins: { title: { display: true, text: title } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'ê±´ìˆ˜' } },
                y1: {
                    position: 'right',
                    beginAtZero: true,
                    grid: { drawOnChartArea: false },
                    title: { display: true, text: 'ë¶ˆëŸ‰ë¥ (%)' }
                }
            }
        }
    });
}

function fetchAndRender(url, canvasId, title, labelKey = 'std_date') {
    $.getJSON(url, function(data) {
        const labels = data.map(d => d[labelKey]);
        const good = data.map(d => d.good_count || d.ok_count || 0);
        const bad = data.map(d => d.bad_count || d.ng_count || 0);
        const rate = data.map(d => d.bad_rate || d.ng_rate || 0);
        renderChart(canvasId, labels, { good, bad, rate }, title);
    });
}

$(function() {
    fetchAndRender('/stats/daily', 'dailyChart', 'ğŸ“† ì¼ê°„ í†µê³„');
    fetchAndRender('/stats/weekly', 'weeklyChart', 'ğŸ“… ì£¼ê°„ í†µê³„', 'week_label');
    fetchAndRender('/stats/monthly', 'monthlyChart', 'ğŸ—“ï¸ ì›”ê°„ í†µê³„', 'year_months');
});
</script>
</body>
</html>