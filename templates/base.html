<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- block title: ê° í˜ì´ì§€ì˜ ì œëª©ì´ ì—¬ê¸°ì— ë“¤ì–´ì˜µë‹ˆë‹¤ -->
<title>{% block title %}{% endblock %} - X-Ray ì´ë¬¼ ê²€ì¶œ ì‹œìŠ¤í…œ</title>

<!-- Favicon ì„¤ì • ì‹œì‘ -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon/apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon/favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon/favicon-16x16.png') }}">
<link rel="icon" href="{{ url_for('static', filename='img/favicon/favicon.ico') }}" type="image/x-icon">

<!-- ê³µí†µ CSS íŒŒì¼ ì—°ê²° -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<!-- ê¸°ì¡´ í˜ì´ì§€ë“¤ì—ì„œ ì‚¬ìš©í•˜ë˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì—¬ê¸°ì— ëª¨ì•„ë‘¡ë‹ˆë‹¤ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<!-- ê° í˜ì´ì§€ë³„ë¡œ ì¶”ê°€í•  head ë‚´ìš©ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ë“¤ì–´ì˜µë‹ˆë‹¤ -->
{% block head %}{% endblock %}
</head>
<body>
  <!-- âœ¨ [ìƒˆë¡œ ì¶”ê°€] í† ìŠ¤íŠ¸ ì•Œë¦¼ì„ ìœ„í•œ HTML êµ¬ì¡° -->
    <div id="toast-notification">
        <span id="toast-message"></span>
        <button id="toast-close">&times;</button>
    </div>
  <!-- ìƒë‹¨ ê³ ì • ë©”ë‰´ë°” í¬í•¨ -->
  <header class="site-header">
    <div class="container">
      <div class="logo">
          <a href="{{ url_for('index') }}">
              <img id="logo-img" src="{{ url_for('static', filename='img/TeamLogo_white.png') }}" alt="FUBAO" />
          </a>
      </div>
      <nav class="main-nav">
        <ul>
          {% if current_user.is_authenticated %}
              <li class="nav-item-dropdown">
                  <a href="#" class="nav-user">
                      <!-- âœ¨ [í•µì‹¬ ìˆ˜ì • 1] ê´€ë¦¬ìì¼ ê²½ìš° '[ê´€ë¦¬ì]' í…ìŠ¤íŠ¸ ì¶”ê°€ -->
                      {% if current_user.is_admin %}
                          <span class="admin-badge">[ê´€ë¦¬ì]</span>
                      {% endif %}
                      {{ current_user.name }}ë‹˜
                  </a>
                  <ul class="dropdown-menu">
                      <!-- âœ¨ [í•µì‹¬ ìˆ˜ì • 2] ê´€ë¦¬ìì¼ ê²½ìš° 'íšŒì› ê´€ë¦¬' ë©”ë‰´ í•­ëª© ì¶”ê°€ -->
                      {% if current_user.is_admin %}
                          <li><a href="{{ url_for('admin_dashboard') }}">íšŒì› ê´€ë¦¬</a></li>
                      {% endif %}
                      <li><a href="{{ url_for('profile') }}">ê³„ì • ê´€ë¦¬</a></li>
                      <li><a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a></li>
                  </ul>
              </li>
              <li><a href="{{ url_for('list_page') }}">ëª©ë¡</a></li>
          {% else %}
              <li><a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a></li>
              <li><a href="{{ url_for('register') }}">íšŒì›ê°€ì…</a></li>
          {% endif %}
        </ul>
      </nav>
    </div></header>
  <main class="main-container">
        <!-- âœ¨ [ìˆ˜ì •] flash ë©”ì‹œì§€ êµ¬ì¡° ë‹¨ìˆœí™” -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-container" style="display: none;">
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

  <footer>
      <div class="footer-container">
          <p>&copy; 2025 YOLO Project Team Fubao. All Rights Reserved.</p>
          <p>X-Ray ë¶„ë§ìœ í¬ë¦¼ ì´ë¬¼ì§ˆ ê²€ì¶œ í”„ë¡œì íŠ¸</p>
      </div>
  </footer>

  <script>
    $(document).ready(function() {
      // --- âœ¨ í† ìŠ¤íŠ¸ ì•Œë¦¼ì°½ ê¸°ëŠ¥ ---
      function showToast(message) {
        $('#toast-message').text(message);
        $('#toast-notification').addClass('show');
        // 3ì´ˆ í›„ì— ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ í•¨
        setTimeout(function() {
          $('#toast-notification').removeClass('show');
        }, 3000);
      }

      // í† ìŠ¤íŠ¸ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      $('#toast-close').on('click', function() {
        $('#toast-notification').removeClass('show');
      });

      // íŠ¹ì • ì¹´í…Œê³ ë¦¬ì˜ flash ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´ í† ìŠ¤íŠ¸ë¥¼ ë„ì›€
      const loginSuccessMsg = $('.flash-message.login_success');
      if (loginSuccessMsg.length > 0) {
        showToast(loginSuccessMsg.text());
      }
      const logoutSuccessMsg = $('.flash-message.logout_success');
      if (logoutSuccessMsg.length > 0) {
        showToast(logoutSuccessMsg.text());
      }
      const registerSuccessMsg = $('.flash-message.register_success');
      if (registerSuccessMsg.length > 0) {
        showToast(registerSuccessMsg.text());
      }

      // ğŸ‘‡ [í•µì‹¬ ì¶”ê°€] í”„ë¡œí•„ ìˆ˜ì • ì„±ê³µ ë©”ì‹œì§€ë¥¼ ê°ì§€í•˜ëŠ” ë¸”ë¡ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
      const profileSuccessMsg = $('.flash-message.profile_success');
      if (profileSuccessMsg.length > 0) {
        showToast(profileSuccessMsg.text());
      }

      // ğŸ‘‡ [í•µì‹¬ ì¶”ê°€] ë¡œê·¸ì¸ 'ì˜¤ë¥˜' ë©”ì‹œì§€ë¥¼ ê°ì§€í•˜ëŠ” ë¸”ë¡ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
      const loginErrorMsg = $('.flash-message.login_error');
      if (loginErrorMsg.length > 0) {
          // 1. ê¸°ì¡´ì²˜ëŸ¼ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ëŠ” ê·¸ëŒ€ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
          showToast(loginErrorMsg.text());

          // 2. [í•µì‹¬ ì¶”ê°€] login.htmlì— ìˆëŠ” #login-formì— .form-error í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
          //    ì´ ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ìˆœê°„, CSSì— ì •ì˜ëœ ëŒ€ë¡œ ì…ë ¥ì°½ì´ í”ë“¤ë¦¬ê³  í…Œë‘ë¦¬ê°€ ë¹¨ê°œì§‘ë‹ˆë‹¤.
          $('#login-form').addClass('form-error');

          // 3. [ì„ íƒ ì‚¬í•­: UX ê°œì„ ] ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„(0.5ì´ˆ ë’¤) í´ë˜ìŠ¤ë¥¼ ë‹¤ì‹œ ì œê±°í•˜ì—¬
          //    ì‚¬ìš©ìê°€ ë‹¤ì‹œ íƒ€ì´í•‘í•  ë•Œ ë¹¨ê°„ í…Œë‘ë¦¬ê°€ ì‚¬ë¼ì§€ê²Œ ë§Œë“­ë‹ˆë‹¤.
          setTimeout(function() {
              $('#login-form').removeClass('form-error');
          }, 500); // 500ms = 0.5ì´ˆ
      }

      // --- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬ ---
      $('.nav-user').on('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        $('.dropdown-menu').toggleClass('show');
      });

      $(document).on('click', function(event) {
        if ($('.dropdown-menu').hasClass('show') && !$(event.target).closest('.nav-item-dropdown').length) {
          $('.dropdown-menu').removeClass('show');
        }
      });
    });

    // --- ê¸°ì¡´ ë¡œê³  ì´ë¯¸ì§€ ë³€ê²½ ìŠ¤í¬ë¦½íŠ¸ ---
    document.querySelector('.site-header').addEventListener('mouseenter', function() {
        document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo.png') }}";
    });
    document.querySelector('.site-header').addEventListener('mouseleave', function() {
        document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo_white.png') }}";
    });
  </script>
</body>
</html>