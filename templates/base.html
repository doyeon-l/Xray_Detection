<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- block title: ê° í˜ì´ì§€ì˜ ì œëª©ì´ ì—¬ê¸°ì— ë“¤ì–´ì˜µë‹ˆë‹¤ -->
<title>{% block title %}{% endblock %} - X-Ray ì´ë¬¼ ê²€ì¶œ ì‹œìŠ¤í…œ</title>

<!-- Favicon ì„¤ì • ì‹œì‘ -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon/apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon/favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon/favicon-16x16.png') }}">
<link rel="icon" href="{{ url_for('static', filename='img/favicon/favicon.ico') }}" type="image/x-icon">

<!-- ê³µí†µ CSS íŒŒì¼ ì—°ê²° -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<!-- ğŸš€ [ì‹ ê·œ] Font Awesome ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- ê¸°ì¡´ í˜ì´ì§€ë“¤ì—ì„œ ì‚¬ìš©í•˜ë˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì—¬ê¸°ì— ëª¨ì•„ë‘¡ë‹ˆë‹¤ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<!-- ê° í˜ì´ì§€ë³„ë¡œ ì¶”ê°€í•  head ë‚´ìš©ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ë“¤ì–´ì˜µë‹ˆë‹¤ -->
{% block head %}{% endblock %}
</head>
<body>
  <!-- ğŸš€ [ì‹ ê·œ] íŒŒì¼ ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œë¥¼ ìœ„í•œ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="upload-progress-overlay">
    <div class="progress-box">
      <div class="spinner"></div>
      <p id="progress-text">ì—…ë¡œë“œ ì¤‘...</p>
      <div class="progress-bar-container">
        <div id="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- âœ¨ [ìƒˆë¡œ ì¶”ê°€] í† ìŠ¤íŠ¸ ì•Œë¦¼ì„ ìœ„í•œ HTML êµ¬ì¡° -->
    <div id="toast-notification">
        <span id="toast-message"></span>
        <button id="toast-close">&times;</button>
    </div>
  <!-- ìƒë‹¨ ê³ ì • ë©”ë‰´ë°” í¬í•¨ -->
  <header class="site-header">
    <div class="container">
      <div class="logo">
          <a href="{{ url_for('index') }}">
              <img id="logo-img" src="{{ url_for('static', filename='img/TeamLogo_white.png') }}" alt="FUBAO" />
          </a>
      </div>
      <nav class="main-nav">
        <ul>
          {% if current_user.is_authenticated %}
              <li class="nav-item-dropdown">
                  <a href="#" class="nav-user">
                      <!-- âœ¨ [í•µì‹¬ ìˆ˜ì • 1] ê´€ë¦¬ìì¼ ê²½ìš° '[ê´€ë¦¬ì]' í…ìŠ¤íŠ¸ ì¶”ê°€ -->
                      {% if current_user.is_admin %}
                          <span class="admin-badge">[ê´€ë¦¬ì]</span>
                      {% endif %}
                      {{ current_user.name }}ë‹˜
                  </a>
                  <ul class="dropdown-menu">
                      <!-- âœ¨ [í•µì‹¬ ìˆ˜ì • 2] ê´€ë¦¬ìì¼ ê²½ìš° 'íšŒì› ê´€ë¦¬' ë©”ë‰´ í•­ëª© ì¶”ê°€ -->
                      {% if current_user.is_admin %}
                          <li><a href="{{ url_for('admin_dashboard') }}">íšŒì› ê´€ë¦¬</a></li>
                          <li><a href="{{ url_for('model_management') }}">ëª¨ë¸ ê´€ë¦¬</a></li>
                      {% endif %}
                      <li><a href="{{ url_for('profile') }}">ê³„ì • ê´€ë¦¬</a></li>
                      <li><a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a></li>
                  </ul>
              </li>
              <li><a href="{{ url_for('list_page') }}">ëª©ë¡</a></li>
          {% else %}
              <li><a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a></li>
              <li><a href="{{ url_for('register') }}">íšŒì›ê°€ì…</a></li>
          {% endif %}
        </ul>
      </nav>
    </div></header>
  <main class="main-container">
        <!-- âœ¨ [ìˆ˜ì •] flash ë©”ì‹œì§€ êµ¬ì¡° ë‹¨ìˆœí™” -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-container" style="display: none;">
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

  <footer>
      <div class="footer-container">
          <p>&copy; 2025 YOLO Project Team Fubao. All Rights Reserved.</p>
          <p>X-Ray ë¶„ë§ìœ í¬ë¦¼ ì´ë¬¼ì§ˆ ê²€ì¶œ í”„ë¡œì íŠ¸</p>
      </div>
  </footer>

  <script>
    $(document).ready(function() {
      // --- âœ¨ í† ìŠ¤íŠ¸ ì•Œë¦¼ì°½ ê¸°ëŠ¥ì„ ë²”ìš© í•¨ìˆ˜ë¡œ ë³€ê²½ ---
      function showToast(message, type = 'info') {
        const toast = $('#toast-notification');
        toast.removeClass('success error'); // ê¸°ì¡´ í´ë˜ìŠ¤ ì´ˆê¸°í™”

        if (type === 'success') toast.addClass('success');
        else if (type === 'error') toast.addClass('error');

        $('#toast-message').text(message);
        toast.addClass('show');

        setTimeout(() => { toast.removeClass('show'); }, 3000);
      }

      $('#toast-close').on('click', () => { $('#toast-notification').removeClass('show'); });

      // --- âœ¨ [í•µì‹¬ ì¶”ê°€] ì´ í•¨ìˆ˜ë¥¼ ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì“¸ ìˆ˜ ìˆë„ë¡ ì „ì—­ ë³€ìˆ˜ë¡œ ë§Œë“­ë‹ˆë‹¤. ---
      window.showToast = showToast;

      // --- ê¸°ì¡´ Flash ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§ (ì´ì œ showToast í•¨ìˆ˜ë¥¼ ì‚¬ìš©) ---
      const flashMessages = {
          'login_success': { type: 'success' },
          'register_success': { type: 'success' },
          'profile_success': { type: 'success' },
          'logout_success': { type: 'info' },
          'login_error': { type: 'error' }
      };

      for (const className in flashMessages) {
          const msgElement = $(`.flash-message.${className}`);
          if (msgElement.length > 0) {
              const config = flashMessages[className];
              showToast(msgElement.text(), config.type);

              // ë¡œê·¸ì¸ ì—ëŸ¬ ì‹œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
              if (className === 'login_error') {
                  $('#login-form').addClass('form-error');
                  setTimeout(() => { $('#login-form').removeClass('form-error'); }, 500);
              }
          }
      }

      // --- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë° ë¡œê³  ì´ë²¤íŠ¸ ì²˜ë¦¬ (ê¸°ì¡´ê³¼ ë™ì¼) ---
      $('.nav-user').on('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        $('.dropdown-menu').toggleClass('show');
      });

      $(document).on('click', function(event) {
        if ($('.dropdown-menu').hasClass('show') && !$(event.target).closest('.nav-item-dropdown').length) {
          $('.dropdown-menu').removeClass('show');
        }
      });

      document.querySelector('.site-header').addEventListener('mouseenter', function() {
          document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo.png') }}";
      });
      document.querySelector('.site-header').addEventListener('mouseleave', function() {
          document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo_white.png') }}";
      });
    });
  </script>
</body>
</html>