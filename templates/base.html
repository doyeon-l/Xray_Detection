<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- block title: 각 페이지의 제목이 여기에 들어옵니다 -->
<title>{% block title %}{% endblock %} - X-Ray 이물 검출 시스템</title>

<!-- Favicon 설정 시작 -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon/apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon/favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon/favicon-16x16.png') }}">
<link rel="icon" href="{{ url_for('static', filename='img/favicon/favicon.ico') }}" type="image/x-icon">

<!-- 공통 CSS 파일 연결 -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<!-- 기존 페이지들에서 사용하던 라이브러리들을 여기에 모아둡니다 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<!-- 각 페이지별로 추가할 head 내용이 있다면 여기에 들어옵니다 -->
{% block head %}{% endblock %}
</head>
<body>
  <!-- ✨ [새로 추가] 토스트 알림을 위한 HTML 구조 -->
    <div id="toast-notification">
        <span id="toast-message"></span>
        <button id="toast-close">&times;</button>
    </div>
  <!-- 상단 고정 메뉴바 포함 -->
  <header class="site-header">
    <div class="container">
      <div class="logo">
          <a href="{{ url_for('index') }}">
              <img id="logo-img" src="{{ url_for('static', filename='img/TeamLogo_white.png') }}" alt="FUBAO" />
          </a>
      </div>
      <nav class="main-nav">
        <ul>
          {% if current_user.is_authenticated %}
              <li class="nav-item-dropdown">
                  <a href="#" class="nav-user">
                      <!-- ✨ [핵심 수정 1] 관리자일 경우 '[관리자]' 텍스트 추가 -->
                      {% if current_user.is_admin %}
                          <span class="admin-badge">[관리자]</span>
                      {% endif %}
                      {{ current_user.name }}님
                  </a>
                  <ul class="dropdown-menu">
                      <!-- ✨ [핵심 수정 2] 관리자일 경우 '회원 관리' 메뉴 항목 추가 -->
                      {% if current_user.is_admin %}
                          <li><a href="{{ url_for('admin_dashboard') }}">회원 관리</a></li>
                      {% endif %}
                      <li><a href="{{ url_for('profile') }}">계정 관리</a></li>
                      <li><a href="{{ url_for('logout') }}">로그아웃</a></li>
                  </ul>
              </li>
              <li><a href="{{ url_for('list_page') }}">목록</a></li>
          {% else %}
              <li><a href="{{ url_for('login') }}">로그인</a></li>
              <li><a href="{{ url_for('register') }}">회원가입</a></li>
          {% endif %}
        </ul>
      </nav>
    </div></header>
  <main class="main-container">
        <!-- ✨ [수정] flash 메시지 구조 단순화 -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-container" style="display: none;">
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

  <footer>
      <div class="footer-container">
          <p>&copy; 2025 YOLO Project Team Fubao. All Rights Reserved.</p>
          <p>X-Ray 분말유크림 이물질 검출 프로젝트</p>
      </div>
  </footer>

  <script>
    $(document).ready(function() {
      // --- ✨ 토스트 알림창 기능 ---
      function showToast(message) {
        $('#toast-message').text(message);
        $('#toast-notification').addClass('show');
        // 3초 후에 자동으로 사라지게 함
        setTimeout(function() {
          $('#toast-notification').removeClass('show');
        }, 3000);
      }

      // 토스트 닫기 버튼 클릭 이벤트
      $('#toast-close').on('click', function() {
        $('#toast-notification').removeClass('show');
      });

      // 특정 카테고리의 flash 메시지가 있으면 토스트를 띄움
      const loginSuccessMsg = $('.flash-message.login_success');
      if (loginSuccessMsg.length > 0) {
        showToast(loginSuccessMsg.text());
      }
      const logoutSuccessMsg = $('.flash-message.logout_success');
      if (logoutSuccessMsg.length > 0) {
        showToast(logoutSuccessMsg.text());
      }
      const registerSuccessMsg = $('.flash-message.register_success');
      if (registerSuccessMsg.length > 0) {
        showToast(registerSuccessMsg.text());
      }

      // 👇 [핵심 추가] 프로필 수정 성공 메시지를 감지하는 블록을 추가합니다.
      const profileSuccessMsg = $('.flash-message.profile_success');
      if (profileSuccessMsg.length > 0) {
        showToast(profileSuccessMsg.text());
      }

      // 👇 [핵심 추가] 로그인 '오류' 메시지를 감지하는 블록을 추가합니다.
      const loginErrorMsg = $('.flash-message.login_error');
      if (loginErrorMsg.length > 0) {
          // 1. 기존처럼 토스트 메시지는 그대로 보여줍니다.
          showToast(loginErrorMsg.text());

          // 2. [핵심 추가] login.html에 있는 #login-form에 .form-error 클래스를 추가합니다.
          //    이 코드가 실행되는 순간, CSS에 정의된 대로 입력창이 흔들리고 테두리가 빨개집니다.
          $('#login-form').addClass('form-error');

          // 3. [선택 사항: UX 개선] 애니메이션이 끝난 후(0.5초 뒤) 클래스를 다시 제거하여
          //    사용자가 다시 타이핑할 때 빨간 테두리가 사라지게 만듭니다.
          setTimeout(function() {
              $('#login-form').removeClass('form-error');
          }, 500); // 500ms = 0.5초
      }

      // --- 드롭다운 메뉴 클릭 이벤트 처리 ---
      $('.nav-user').on('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        $('.dropdown-menu').toggleClass('show');
      });

      $(document).on('click', function(event) {
        if ($('.dropdown-menu').hasClass('show') && !$(event.target).closest('.nav-item-dropdown').length) {
          $('.dropdown-menu').removeClass('show');
        }
      });
    });

    // --- 기존 로고 이미지 변경 스크립트 ---
    document.querySelector('.site-header').addEventListener('mouseenter', function() {
        document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo.png') }}";
    });
    document.querySelector('.site-header').addEventListener('mouseleave', function() {
        document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo_white.png') }}";
    });
  </script>
</body>
</html>