<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- block title: 각 페이지의 제목이 여기에 들어옵니다 -->
<title>{% block title %}{% endblock %} - X-Ray 이물 검출 시스템</title>

<!-- Favicon 설정 시작 -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon/apple-touch-icon.png') }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon/favicon-32x32.png') }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon/favicon-16x16.png') }}">
<link rel="icon" href="{{ url_for('static', filename='img/favicon/favicon.ico') }}" type="image/x-icon">

<!-- 공통 CSS 파일 연결 -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<!-- 🚀 [신규] Font Awesome 아이콘 라이브러리 추가 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- 기존 페이지들에서 사용하던 라이브러리들을 여기에 모아둡니다 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<!-- 각 페이지별로 추가할 head 내용이 있다면 여기에 들어옵니다 -->
{% block head %}{% endblock %}
</head>
<body>
  <!-- 🚀 [신규] 파일 업로드 진행률 표시를 위한 로딩 오버레이 -->
  <div id="upload-progress-overlay">
    <div class="progress-box">
      <div class="spinner"></div>
      <p id="progress-text">업로드 중...</p>
      <div class="progress-bar-container">
        <div id="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- ✨ [새로 추가] 토스트 알림을 위한 HTML 구조 -->
    <div id="toast-notification">
        <span id="toast-message"></span>
        <button id="toast-close">&times;</button>
    </div>
  <!-- 상단 고정 메뉴바 포함 -->
  <header class="site-header">
    <div class="container">
      <div class="logo">
          <a href="{{ url_for('index') }}">
              <img id="logo-img" src="{{ url_for('static', filename='img/TeamLogo_white.png') }}" alt="FUBAO" />
          </a>
      </div>
      <nav class="main-nav">
        <ul>
          {% if current_user.is_authenticated %}
              <li class="nav-item-dropdown">
                  <a href="#" class="nav-user">
                      <!-- ✨ [핵심 수정 1] 관리자일 경우 '[관리자]' 텍스트 추가 -->
                      {% if current_user.is_admin %}
                          <span class="admin-badge">[관리자]</span>
                      {% endif %}
                      {{ current_user.name }}님
                  </a>
                  <ul class="dropdown-menu">
                      <!-- ✨ [핵심 수정 2] 관리자일 경우 '회원 관리' 메뉴 항목 추가 -->
                      {% if current_user.is_admin %}
                          <li><a href="{{ url_for('admin_dashboard') }}">회원 관리</a></li>
                          <li><a href="{{ url_for('model_management') }}">모델 관리</a></li>
                      {% endif %}
                      <li><a href="{{ url_for('profile') }}">계정 관리</a></li>
                      <li><a href="{{ url_for('logout') }}">로그아웃</a></li>
                  </ul>
              </li>
              <li><a href="{{ url_for('list_page') }}">목록</a></li>
          {% else %}
              <li><a href="{{ url_for('login') }}">로그인</a></li>
              <li><a href="{{ url_for('register') }}">회원가입</a></li>
          {% endif %}
        </ul>
      </nav>
    </div></header>
  <main class="main-container">
        <!-- ✨ [수정] flash 메시지 구조 단순화 -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-container" style="display: none;">
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

  <footer>
      <div class="footer-container">
          <p>&copy; 2025 YOLO Project Team Fubao. All Rights Reserved.</p>
          <p>X-Ray 분말유크림 이물질 검출 프로젝트</p>
      </div>
  </footer>

  <script>
    $(document).ready(function() {
      // --- ✨ 토스트 알림창 기능을 범용 함수로 변경 ---
      function showToast(message, type = 'info') {
        const toast = $('#toast-notification');
        toast.removeClass('success error'); // 기존 클래스 초기화

        if (type === 'success') toast.addClass('success');
        else if (type === 'error') toast.addClass('error');

        $('#toast-message').text(message);
        toast.addClass('show');

        setTimeout(() => { toast.removeClass('show'); }, 3000);
      }

      $('#toast-close').on('click', () => { $('#toast-notification').removeClass('show'); });

      // --- ✨ [핵심 추가] 이 함수를 다른 스크립트에서 쓸 수 있도록 전역 변수로 만듭니다. ---
      window.showToast = showToast;

      // --- 기존 Flash 메시지 처리 로직 (이제 showToast 함수를 사용) ---
      const flashMessages = {
          'login_success': { type: 'success' },
          'register_success': { type: 'success' },
          'profile_success': { type: 'success' },
          'logout_success': { type: 'info' },
          'login_error': { type: 'error' }
      };

      for (const className in flashMessages) {
          const msgElement = $(`.flash-message.${className}`);
          if (msgElement.length > 0) {
              const config = flashMessages[className];
              showToast(msgElement.text(), config.type);

              // 로그인 에러 시 애니메이션 효과 추가
              if (className === 'login_error') {
                  $('#login-form').addClass('form-error');
                  setTimeout(() => { $('#login-form').removeClass('form-error'); }, 500);
              }
          }
      }

      // --- 드롭다운 메뉴 및 로고 이벤트 처리 (기존과 동일) ---
      $('.nav-user').on('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        $('.dropdown-menu').toggleClass('show');
      });

      $(document).on('click', function(event) {
        if ($('.dropdown-menu').hasClass('show') && !$(event.target).closest('.nav-item-dropdown').length) {
          $('.dropdown-menu').removeClass('show');
        }
      });

      document.querySelector('.site-header').addEventListener('mouseenter', function() {
          document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo.png') }}";
      });
      document.querySelector('.site-header').addEventListener('mouseleave', function() {
          document.getElementById('logo-img').src = "{{ url_for('static', filename='img/TeamLogo_white.png') }}";
      });
    });
  </script>
</body>
</html>